# 아키텍처: 커맨드 시스템 원칙

> **구현 위치**: `src/os/3-commands/`
> **진실의 원천**: [SPEC.md](../SPEC.md) §3 (Command Behavior Table)

---

## 1. 허용적 디스패치 & 헤드리스 실행

> **원칙**: "UI는 신중하게, 엔진은 생산적으로."

- **UI 게이트키퍼**: 키바인딩과 버튼은 트리거 허용 전에 `when` 조건을 확인해야 함.
- **헤드리스 엔진**: `kernel.dispatch()`는 `when` 절을 강제하지 않음. 헤드리스 자동화, 초기화, 매크로 실행 가능.
- **내부 가드**: `run` 함수는 UX 규칙과 분리된 "안전 가드"(null 데이터 확인 등)를 구현하여 크래시 방지.

## 2. 의도 기반 커맨드

명시적 사용자 의도(User Intent)와 암묵적 시스템 동작(System Action)을 구분한다.

- **커맨드**: 명시적 사용자 내비게이션(방향키, 점프 이동)은 커맨드여야 함 (예: `OS_NAVIGATE`, `OS_FOCUS`).
- **내부 부수 효과**: 암묵적 조정(삭제 후 자동 포커싱)은 미들웨어 또는 반응형 레이어에서 처리. 새 커맨드를 디스패치하지 않음.

## 3. 컨텍스트 & 가상 물리

DOM 대신 순수 상태에서 "물리적" 정보를 파생한다.

- **프로젝션**: DOM `getBoundingClientRect()` 대신 `zoneRegistry`의 아이템 순서에서 위치 계산.
- **계산된 컨텍스트**: `when` 조건에 필요한 환경 정보(`DOM_ITEMS`, `ZONE_CONFIG`, `DOM_RECTS`)가 상태에서 Context로 투영.
- **조건 레지스트리**: 논리적 검사는 명명된 조건(예: `isEditing`, `isFieldActive`)으로 중앙화.

---

*축소 정리: 2026-02-18 — 소스 경로 현행화, 구현 상세는 SPEC.md로 위임*
