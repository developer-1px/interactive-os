# ë¦¬ë§¤í•‘ Discussion Journey

## ë°œë‹¨

**ğŸ§‘ ì‚¬ìš©ì**: ë¦¬ë§¤í•‘

**ğŸ¤– AI**: `getCanonicalKey`ê°€ Macì—ì„œ `Meta+Arrow â†’ Home/End`ë¡œ ë³€í™˜, OS_MOVE_UP/DOWN í‚¤ë°”ì¸ë”©ì— ë„ë‹¬ ë¶ˆê°€. ì„¤ê³„ ì›ì¹™ì„ ë…¼ì˜í•˜ì.

---

## 1ì°¨ ì „í™˜: Fallback

**ğŸ§‘ ì‚¬ìš©ì**: ë¦¬ë§¤í•‘ì´ fallbackì´ì–´ì•¼ í•œë‹¤ ìƒê°í•´

**ğŸ¤– AI**: ë’¤ì§‘ìœ¼ë©´ `Meta+ArrowUp` ë¨¼ì € resolve â†’ miss â†’ normalize â†’ ì¬ì‹œë„. "êµ¬ì²´ì  ë°”ì¸ë”© ìš°ì„ " = CSS specificity íŒ¨í„´ê³¼ ë™ì¼.

---

## 2ì°¨ ì „í™˜: ë¯¸ë“¤ì›¨ì–´

**ğŸ§‘ ì‚¬ìš©ì**: í‚¤ ë°”ì¸ë”©ë„ ê³ ë¯¼í–ˆëŠ”ë° ë¯¸ë“¤ì›¨ì–´ì¸ ê±° ê°™ì•„

**ğŸ¤– AI**: Mac normalization = ë¯¸ë“¤ì›¨ì–´. `KeyboardPipeline.use(MacNormalizationMiddleware)`.

**ğŸ§‘ ì‚¬ìš©ì**: ìš°ë¦¬ ì»¤ë„ ë¯¸ë“¤ì›¨ì–´

**ğŸ¤– AI**: í‚¤ë³´ë“œ ì „ìš© íŒŒì´í”„ë¼ì¸ì´ ì•„ë‹ˆë¼ ì»¤ë„ ë¯¸ë“¤ì›¨ì–´ë¡œ í†µí•©.

**ğŸ§‘ ì‚¬ìš©ì**: ì•„ë‹ˆ ë¯¸ë“¤ì›¨ì–´ë¥¼ í™•ì¥í•˜ì

**ğŸ¤– AI**: ë¯¸ë“¤ì›¨ì–´ ì¸í„°í˜ì´ìŠ¤ì— `resolve` í›… ì¶”ê°€.

---

## 3ì°¨ ì „í™˜: Keybindings ì œê±°?

**ğŸ§‘ ì‚¬ìš©ì**: í‚¤ë°”ì¸ë”© ì œê±° í‚¤ ë¦¬ìŠ¤ë„ˆë¥¼ í™œìš©

**ğŸ¤– AI**: Keybindings ì‹œìŠ¤í…œ ìì²´ë¥¼ ì—†ì• ê³  ë¯¸ë“¤ì›¨ì–´ê°€ í‚¤â†’ì»¤ë§¨ë“œ ë§¤í•‘. ë¦¬ìŠ¤ë„ˆëŠ” ì´ë²¤íŠ¸ë§Œ ë„˜ê¸°ëŠ” ë°”ë³´.

**ğŸ§‘ ì‚¬ìš©ì**: ë¦¬ìŠ¤ë„ˆë¥¼ ë°”ë³´ë¡œ ë§Œë“¤ë©´ ìš°ë¦¬ êµ¬ì¡°ê°€ ë‹¤ ë°”ë€”í…ë°?

**ğŸ¤– AI**: Focus/Click ë¦¬ìŠ¤ë„ˆê¹Œì§€ ì „ë¶€ ì˜í–¥ â€” ì•„í‚¤í…ì²˜ ì „í™˜ ìˆ˜ì¤€.

---

## 4ì°¨ ì „í™˜: DOM ê²½ê³„ ë°œê²¬

**ğŸ§‘ ì‚¬ìš©ì**: ì•ˆí• ê±°ì•¼ ê·¼ë° ê³ ë¯¼ì€ í•´ë³´ì focus ë¯¸ë“¤ì›¨ì–´ expand ë¯¸ë“¤ì›¨ì–´ ìš°ì•„í•œ ë””ìì¸ì¸ê°€?

**ğŸ¤– AI**: í‚¤ë³´ë“œ = ìˆœìˆ˜(ë¬¸ìì—´) â†’ ë¯¸ë“¤ì›¨ì–´ ì í•©. Focus/Click = DOM ì°¸ì¡° í•„ìš” â†’ ë¦¬ìŠ¤ë„ˆì— ë‚¨ì•„ì•¼. **ê²½ê³„ì„  = DOM ì°¸ì¡° ìœ ë¬´.**

**ğŸ§‘ ì‚¬ìš©ì**: ê·¸ë˜ì„œ ë˜‘ë˜‘í•œ ë¦¬ìŠ¤ë„ˆê°€ ì§€ í• ì¼ì„ ë‹¤í•˜ê³  ë‚˜ë¨¸ì§€ëŠ” fallbackìœ¼ë¡œ ë¯¸ë“¤ì›¨ì–´ì—ê²Œ ì£¼ëŠ” ê±°

**ğŸ¤– AI**: ë¦¬ìŠ¤ë„ˆ = 1ì°¨ resolve + DOM í•´ì„. miss â†’ ë¯¸ë“¤ì›¨ì–´ fallback. ì•„í‚¤í…ì²˜ ë³€ê²½ ì—†ìŒ.

---

## 5ì°¨ ì „í™˜: ë…¸ì´ì¦ˆì™€ Event

**ğŸ§‘ ì‚¬ìš©ì**: UNRESOLVED ë‹¨ ì´ê±´ ë¡œê·¸ íƒ€ë©´ ë…¸ì´ì¦ˆ ë¬¸ì œëŠ”?

**ğŸ¤– AI**: 3ê°œ ì„ íƒì§€ ì œì‹œ. ì‚¬ìš©ì 1ë²ˆ ì„ íƒ â†’ `kernel.resolveFallback()` â€” dispatch/íŠ¸ëœì­ì…˜ ì•ˆ íƒ€ëŠ” ì‚¬ì´ë“œ ì±„ë„.

**ğŸ§‘ ì‚¬ìš©ì**: ë§ˆìš°ìŠ¤ í´ë¦½ë³´ë“œ ë™ì¼ íŒ¨í„´

**ğŸ¤– AI**: keyboard/mouse/clipboard ëª¨ë‘ "ë¦¬ìŠ¤ë„ˆ 1ì°¨ â†’ miss â†’ resolveFallback" ë™ì¼ íŒ¨í„´.

**ğŸ§‘ ì‚¬ìš©ì**: eventë¥¼ ë„˜ê²¨

**ğŸ¤– AI**: `resolveFallback(nativeEvent)` â€” ë³„ë„ data shape ë¶ˆí•„ìš”, `instanceof`ë¡œ ë¯¸ë“¤ì›¨ì–´ê°€ ìê¸° ê´€ì‹¬ì‚¬ í•„í„°ë§.

---

**í•œì¤„ìš”ì•½**: "ë¦¬ë§¤í•‘ ë²„ê·¸ ê³ ì¹˜ì"ì—ì„œ ì‹œì‘í•´, í‚¤ë³´ë“œâ†’ë¯¸ë“¤ì›¨ì–´â†’ë¦¬ìŠ¤ë„ˆ ì—­í•  ë¶„ë¦¬â†’DOM ê²½ê³„â†’ë²”ìš© fallback íŒ¨í„´ê¹Œì§€ ë„ë‹¬ â€” ìµœì¢… ê²°ë¡ ì€ `kernel.resolveFallback(nativeEvent)`.


---


# ë¦¬ë§¤í•‘ ì„¤ê³„: ë¦¬ìŠ¤ë„ˆ + Fallback ë¯¸ë“¤ì›¨ì–´

## Why
`getCanonicalKey`ì˜ Mac normalization(`Meta+Arrow â†’ Home/End`)ì´ í‚¤ë°”ì¸ë”©ì„ ë¨¹ì–´ë²„ë¦°ë‹¤. ë‹¨ìˆœ ë²„ê·¸ê°€ ì•„ë‹ˆë¼, í‚¤ë³´ë“œ í•´ì„ ê³„ì¸µì˜ ì±…ì„ ê²½ê³„ ë¬¸ì œ.

## Intent
ë¦¬ìŠ¤ë„ˆëŠ” ë˜‘ë˜‘í•˜ê²Œ 1ì°¨ resolveë¥¼ í•˜ê³ , missì¼ ë•Œë§Œ ì»¤ë„ ë¯¸ë“¤ì›¨ì–´ì—ê²Œ fallbackì„ ìœ„ì„í•œë‹¤. ì•„í‚¤í…ì²˜ ë³€ê²½ ì—†ì´ í™•ì¥ í¬ì¸íŠ¸ë¥¼ ì¶”ê°€í•œë‹¤.

## Warrant êµ¬ì¡°

| # | Warrant | ê·¼ê±° |
|---|---------|------|
| W4 | êµ¬ì²´ì  ë°”ì¸ë”© ìš°ì„  (specificity) | CSS specificity, ë¼ìš°í„° ë§¤ì¹­ê³¼ ë™ì¼ íŒ¨í„´ |
| W5 | normalizationì€ ë¯¸ë“¤ì›¨ì–´ë‹¤ | ì œê±°/êµì²´/ìˆœì„œ ë³€ê²½ ê°€ëŠ¥í•´ì•¼ í•œë‹¤ |
| W10 | fallback ì „ëµì€ í˜¸ì¶œìê°€ ê²°ì • | ì»¤ë„ì€ í”Œë«í¼ ëª¨ë¦„, ë¦¬ìŠ¤ë„ˆê°€ ì• |
| W13 | ê²½ê³„ì„  = DOM ì°¸ì¡° ìœ ë¬´ | DOM í•„ìš” â†’ ë¦¬ìŠ¤ë„ˆ, ìˆœìˆ˜ â†’ ë¯¸ë“¤ì›¨ì–´ |
| W14 | ë¦¬ìŠ¤ë„ˆê°€ 1ì°¨, missë§Œ ìœ„ì„ | ê¸°ì¡´ ì•„í‚¤í…ì²˜ ë³€ê²½ ì—†ìŒ |
| W15 | dispatch ì•ˆ íƒ€ì•¼ ë…¸ì´ì¦ˆ ì—†ìŒ | UNRESOLVED ë§¤ í‚¤ìŠ¤íŠ¸ë¡œí¬ â†’ íŠ¸ëœì­ì…˜ ë„ë°° ë°©ì§€ |
| W17 | keyboard/mouse/clipboard ë™ì¼ íŒ¨í„´ | ë²”ìš© ì„¤ê³„ |
| W18 | ë„¤ì´í‹°ë¸Œ Event = ì¸í„°í˜ì´ìŠ¤ | ë³„ë„ data shape ë¶ˆí•„ìš”, instanceofë¡œ í•„í„°ë§ |

## ìµœì¢… ì„¤ê³„

```
DOM Event â†’ ë¦¬ìŠ¤ë„ˆ(ë˜‘ë˜‘) â†’ resolve â†’ hit â†’ dispatch
                                   â†’ miss â†’ kernel.resolveFallback(event)
                                              â†’ ë¯¸ë“¤ì›¨ì–´ ì²´ì¸ ìˆœíšŒ
                                              â†’ hit â†’ dispatch
                                              â†’ miss â†’ ì¡°ìš©íˆ ë
```

```ts
// KeyboardListener
const key = getCanonicalKey(event);      // ìˆœìˆ˜ ë¬¼ë¦¬â†’ë…¼ë¦¬, ë¦¬ë§¤í•‘ ì—†ìŒ
const command = resolve(key, context);
if (command) {
  kernel.dispatch(command);
} else {
  kernel.resolveFallback(event);         // ë„¤ì´í‹°ë¸Œ Event ê·¸ëŒ€ë¡œ
}

// Mac fallback ë¯¸ë“¤ì›¨ì–´
kernel.use({
  id: "mac-normalize",
  fallback: (event) => {
    if (!(event instanceof KeyboardEvent)) return null;
    const normalized = macNormalize(getCanonicalKey(event));
    return resolve(normalized, ctx);
  }
});
```

## ê¸°ê°ëœ ëŒ€ì•ˆ

| ëŒ€ì•ˆ | ê¸°ê° ì´ìœ  |
|------|----------|
| ë¦¬ìŠ¤ë„ˆë¥¼ ë°”ë³´ë¡œ (ì´ë²¤íŠ¸ë§Œ ì „ë‹¬) | Focus/Clickì€ DOM ì°¸ì¡° í•„ìš” â†’ ì»¤ë„ ìˆœìˆ˜ì„± ê¹¨ì§ |
| UNRESOLVED ì»¤ë§¨ë“œ dispatch | íŠ¸ëœì­ì…˜ ë…¸ì´ì¦ˆ |
| ë¯¸ë“¤ì›¨ì–´ ì¸í„°í˜ì´ìŠ¤ì— resolve í›… ì¶”ê°€ | ë¯¸ë“¤ì›¨ì–´ ì¸í„°í˜ì´ìŠ¤ ë³€ê²½ ë¶ˆí•„ìš” |
| getCanonicalKeyì—ì„œ ë¦¬ë§¤í•‘ ì œê±° | Home/End ê¸°ì¡´ ë™ì‘ ê¹¨ì§ |

## êµ¬í˜„ ë²”ìœ„

- ì»¤ë„: `resolveFallback(event)` API ì¶”ê°€ (ë¯¸ë“¤ì›¨ì–´ ì²´ì¸ë§Œ ëŒë¦¼, íŠ¸ëœì­ì…˜ ì•ˆ ë‚¨ê¹€)
- ë¯¸ë“¤ì›¨ì–´ ì¸í„°í˜ì´ìŠ¤: `fallback?: (event: Event) => Command | null` í›… ì¶”ê°€
- KeyboardListener: miss ì‹œ `kernel.resolveFallback(event)` í˜¸ì¶œ
- getCanonicalKey: Mac normalization ì œê±°
- osDefaults: ë³€ê²½ ì—†ìŒ

---

**í•œì¤„ìš”ì•½**: ë¦¬ìŠ¤ë„ˆê°€ 1ì°¨ resolveí•˜ê³  missí•˜ë©´ `kernel.resolveFallback(nativeEvent)`ë¡œ ë¯¸ë“¤ì›¨ì–´ ì²´ì¸ì— ìœ„ì„ â€” ì•„í‚¤í…ì²˜ ë³€ê²½ ì—†ì´ keyboard/mouse/clipboard ê³µí†µ fallback íŒ¨í„´.
