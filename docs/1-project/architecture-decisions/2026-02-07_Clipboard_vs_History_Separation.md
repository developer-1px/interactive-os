# Clipboard vs History: 분리 vs 통합 분석

> **Date**: 2026-02-07  
> **Context**: Focus Pipeline에서 action 커맨드를 분리할 때, clipboard와 history를 한 모듈로 묶을지 별도로 나눌지

---

## 1. 개요

현재 `COPY`, `CUT`, `PASTE`, `DELETE`, `TOGGLE`, `UNDO`, `REDO` 7개 커맨드를 Focus Pipeline에서 분리하려 한다. 이것들의 **공통점은 라우팅 메커니즘** (active Zone의 바인딩 → dispatch)이지만, **도메인은 다르다.**

---

## 2. 분석

### 공통점 (통합 근거)

| 축 | 설명 |
|:---|:---|
| **라우팅 패턴 동일** | 전부 `buildContext()` → `ctx.xxxCommand` 조회 → `dispatch` 반환. 10줄 내외의 동일 구조 |
| **Zone Props** | 모두 Zone의 `onXxx` prop으로 선언. 앱에서 보면 동일한 인터페이스 |
| **Passthrough 전용** | focus state를 변경하지 않음 (TOGGLE 제외). 단순 relay |

### 차이점 (분리 근거)

| 축 | Clipboard | History | Edit (DELETE/TOGGLE) |
|:---|:---|:---|:---|
| **입력 소스** | 브라우저 네이티브 DOM 이벤트 | OS 키바인딩 | OS 키바인딩 |
| **데이터 관심사** | 직렬화, MIME 타입, 시스템 클립보드 API | 상태 스냅샷, Undo 스택 | 없음 |
| **확장 방향** | DnD, 멀티포맷, 외부 앱 연동 | 그룹 Undo, 협업 편집 | 벌크 삭제, 멀티셀렉트 |
| **Sensor 필요성** | ✅ (DOM 이벤트 리스너) | ❌ (키바인딩으로 충분) | ❌ |
| **결합 대상** | 서로 결합 없음 | 서로 결합 없음 | 서로 결합 없음 |

### 핵심 질문: 응집도의 축은 무엇인가?

**옵션 A — 메커니즘 기준 (1개 파이프라인):**
```
action/  ← "Zone 커맨드를 라우팅하는 것" 기준
├── ActionSensor.tsx    (clipboard DOM 이벤트)
├── ActionIntent.tsx    (모든 OS커맨드 리스너)
└── commands/           (COPY, PASTE, UNDO, DELETE...)
```
- 👍 단순, 파일 수 적음, 라우팅 로직 중복 없음
- 👎 clipboard sensor가 history/delete와 같은 폴더에 있는 것이 어색

**옵션 B — 도메인 기준 (2~3개 파이프라인):**
```
clipboard/              ← "데이터 전송" 도메인
├── ClipboardSensor.tsx  (copy/cut/paste DOM 이벤트)
├── ClipboardIntent.tsx  (OS_COPY/CUT/PASTE 리스너)
└── commands/

history/                ← "시간 제어" 도메인
├── HistoryIntent.tsx    (OS_UNDO/REDO 리스너)
└── commands/

# DELETE, TOGGLE은 어디로?
# → focus pipeline에 남기거나, 별도 "editing/" 모듈
```
- 👍 도메인별 독립적 확장 가능, 책임 명확
- 👎 커맨드 파일이 3줄짜리인데 각각 폴더를 만드는 건 과설계

---

## 3. 결론 / 제안

### 추천: **옵션 A (메커니즘 기준, 단일 파이프라인)** + 내부 그룹핑

**이유:**
1. **결합이 없다면 분리할 이유도 약하다.** Clipboard와 History는 서로 호출하지 않고, 공유 상태도 없다. 분리해도 이점이 적다.
2. **현재 규모에서는 과설계.** 각 커맨드가 10줄, 입력 소스 차이는 Sensor 하나로 해결된다.
3. **확장 시 분리하면 된다.** Clipboard에 DnD/직렬화 프로토콜이 추가될 때 그때 분리하는 것이 적절.

**절충안: 내부 파일 그룹핑으로 도메인을 표현**

```
action/
├── ActionSensor.tsx         (clipboard DOM 이벤트만)
├── ActionIntent.tsx         (모든 OS커맨드 → Zone 라우팅)
├── actionCommand.ts         (공유 실행 코어)
└── commands/
    ├── clipboard.ts         ← COPY + CUT + PASTE (한 파일)
    ├── history.ts           ← UNDO + REDO (한 파일)
    └── editing.ts           ← DELETE + TOGGLE (한 파일)
```

이렇게 하면:
- 폴더 구조는 **메커니즘 기준** (단순)
- 파일 내부는 **도메인 기준** (의미 명확)
- 추후 clipboard가 복잡해지면 폴더로 승격 (clipboard/ 독립)

---

*Generated by Antigravity Agent — 2026-02-07T16:59+09:00*
