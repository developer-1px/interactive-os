# Discussion: Collection Zone Facade

> 2026-02-19 23:18 â€“ 23:30

## Journey

**ğŸ§‘ ì‚¬ìš©ì**: ë¹Œë” sidebarì—ì„œë„ copy paste ì„ íƒ shift+ì„ íƒ ë“± ê¸°ë³¸ ë™ì‘ì´ ë™ì¼í•˜ê³  todoListì—ì„œë„ ê±°ì˜ ëŒ€ë¶€ë¶„ ë¹„ìŠ·í•œë°, ì•ìœ¼ë¡œ ì´ëŸ° íŒ¨í„´ì´ ìƒê¸¸ ë•Œë§ˆë‹¤ ë°˜ë³µ ê°œë°œì„ í•´ì•¼í•˜ì§€ ì•Šì•˜ìœ¼ë©´ í•´ì„œ JSON ìì²´ë¥¼ ë‹¤ë£¨ëŠ” ë°˜ë³µë˜ëŠ” ì½”ë“œì˜ ë ˆì´ì–´ë¥¼ ë§Œë“¤ê³  ì‹¶ì–´.

**ğŸ¤– AI**: Intent ì¶”ë¡  â€” "JSON ìì²´ë¥¼ ë‹¤ë£¨ëŠ” ë ˆì´ì–´"ì˜ ìˆ¨ê²¨ì§„ WhyëŠ” ordered-collection UIì˜ ê³µí†µ CRUD/clipboard/ordering ë¡œì§ ì¬ì‚¬ìš©. ì½”ë“œ ë¹„êµ ê²°ê³¼ Todo onDeleteì™€ Builder onDeleteì˜ êµ¬ì¡°ê°€ ë™í˜•.

ì„¤ê³„ ë°©í–¥ìœ¼ë¡œ ì„¸ ê°€ì§€ë¥¼ ì œì‹œ:
1. ë°ì´í„° êµ¬ì¡°ê¹Œì§€ í‘œì¤€í™” (Redux Entity Adapter)
2. ìˆœìˆ˜ ìœ í‹¸ë¦¬í‹°ë§Œ ì œê³µ
3. ìŠ¤í‚¤ë§ˆ ê¸°ë°˜ ìë™ ìƒì„±

---

**ğŸ§‘ ì‚¬ìš©ì**: ë°ì´í„° êµ¬ì¡°ëŠ” ì•±ì—ì„œ ì„¤ì •í•˜ë„ë¡ í•´ì•¼ì§€. ê·¼ë° ê·¸ê±´ Arrayê±°ë‚˜ Objectê² ì§€? JSONì¼í…Œë‹ˆê¹Œ. ì¡°ì‘í•¨ìˆ˜ëŠ” ë¹„ìŠ·í• ê±°ì•¼. ì‹¬ì§€ì–´ ì»¤ë§¨ë“œ ì—°ë™ë„ ë¹„ìŠ·í• ê±°ì•¼. ì•± ìŠ¤í‚¤ë§ˆë§Œ ì „ë‹¬í•˜ë©´ ê±°ì§„ ì•Œì•„ì„œ ë˜ì–´ë„ ë  ë“¯.

**ğŸ¤– AI**: ì´ê±´ ì œ3ì˜ ê¸¸ â€” Redux Toolkitì˜ `createEntityAdapter`ì™€ ê°™ì€ ë°œìƒì´ë˜ ZIFT Zone+bindê¹Œì§€ í™•ì¥. `items` accessor + `schema` (Zod) ë‘ ê°œë©´ APIê°€ ìˆ˜ë ´. accessorê°€ immer draftì—ì„œë„ mutable proxyë¥¼ ë°˜í™˜í•˜ë¯€ë¡œ ì½ê¸°/ì“°ê¸° ë¶„ë¦¬ ë¶ˆí•„ìš”.

Gap: accessorê°€ Array ê¸°ë°˜(Builder)ì—ëŠ” ë§ì§€ë§Œ, entity map + order ë°°ì—´ ë¶„ë¦¬(Todo)ì—ì„œëŠ” `.map()`ì´ ìƒˆ ë°°ì—´ì„ ë°˜í™˜í•´ì„œ draft mutation ë¶ˆê°€.

---

**ğŸ§‘ ì‚¬ìš©ì**: ë®¤í…Œì´í„°ëŠ” ê·¸ëƒ¥ immerë¡œ ë§Œë“¤ê³  zod ë“±ìœ¼ë¡œ ìŠ¤í‚¤ë§ˆë§Œ ì „ë‹¬í•˜ë©´ ë˜ëŠ” ë°©í–¥ìœ¼ë¡œ.

**ğŸ¤– AI**: Zodê°€ "ì„¤ì •"ì´ê³  immerê°€ "ì—”ì§„". ë³„ë„ì˜ clone/serialize ì„¤ì • ë¶ˆí•„ìš” â€” Zodê°€ ê²€ì¦Â·íƒ€ì…ì¶”ë¡ Â·ì§ë ¬í™”ë¥¼ í•œ ë²ˆì— í•´ê²°.

---

**ğŸ§‘ ì‚¬ìš©ì**: ì‹¤ì œë¡œ ì—°ë™í•  ë•Œì—ëŠ” ì •ê·œí™”ë˜ì§€ ì•Šì€ ì†ŒìŠ¤ë“¤ì´ê² ì§€. ì •ê·œí™”/ë¹„ì •ê·œí™” ê³¼ì •ë§Œ í•¨ìˆ˜ë¡œ ë§Œë“¤ë©´ ë˜ì§€ ì•Šì„ê¹Œ?

**ğŸ¤– AI**: **ê²°ì •ì  í†µì°°** â€” ë‚´ë¶€ ì—”ì§„ì€ `{ ids, entities }` ì •ê·œí™” í˜•íƒœ í•˜ë‚˜ë§Œ ë‹¤ë£¨ê³ , ì•±ì€ normalize/denormalizeë§Œ ì œê³µ. Entity+Order êµ¬ì¡°(Todo)ëŠ” ì´ë¯¸ ì •ê·œí™”ëœ í˜•íƒœ â†’ normalizeê°€ ê±°ì˜ identity. `fromArray()`, `fromEntities()` í”„ë¦¬ì…‹ìœ¼ë¡œ í•œ ì¤„ í•´ê²°.

---

**ğŸ§‘ ì‚¬ìš©ì**: ê³ ë¯¼ì´ë„¤, Zoneì„ í™•ì¥í•˜ëŠ” ê²Œ ì•„ë‹ˆë¼ Zoneì€ ìœ ì§€í•˜ê³  ë¯¸ë“¤ì›¨ì–´ë§Œ í™•ì¥í•˜ê³  ì‹¶ì—ˆëŠ”ë°.

**ğŸ¤– AI**: History ë¯¸ë“¤ì›¨ì–´ì™€ ì™„ë²½í•œ ëŒ€ì¹­ â€” Zone ë¬´ìˆ˜ì •, ì»¤ë„ì—ì„œ OS_DELETE/OS_COPYë¥¼ ê°€ë¡œì±„ì„œ ìë™ ì²˜ë¦¬. í•˜ì§€ë§Œ ìš°ì„ ìˆœìœ„ ì¶©ëŒ ë¬¸ì œ ì¡´ì¬ (Zone ì½œë°± vs ë¯¸ë“¤ì›¨ì–´).

---

**ğŸ§‘ ì‚¬ìš©ì**: ë¯¸ë“¤ì›¨ì–´ ë§ê³  Zone Builderë‚˜ Factoryë¡œ í•œë²ˆ ê°ì‹¸ì„œ Collection ë°ì´í„°ë¥¼ í¼ì‚¬ë“œë¡œë§Œ ì¼ë‹¨ ì œê³µí•˜ê³  ê·¸ ë‹¤ìŒì— ê³ ë¯¼í• ê¹Œ?

**ğŸ¤– AI**: ê°€ì¥ í˜„ëª…í•œ ìˆœì„œ. í¼ì‚¬ë“œëŠ” ê¸°ì¡´ ì½”ë“œ ìˆ˜ì • 0 + ì ì§„ì  ë„ì… + ë¯¸ë“¤ì›¨ì–´ ìŠ¹ê²© ê²½ë¡œ ë³´ì¡´. ê²€ì¦ í›„ ë‚´ë¶€ êµ¬í˜„ë§Œ ë°”ê¾¸ë©´ ì™¸ë¶€ ì½”ë“œ ë³€ê²½ 0.

---

**ğŸ§‘ ì‚¬ìš©ì**: í˜„ì¬ ë¹Œë”ì˜ ì‚¬ì´ë“œë°”ì™€ todoì˜ itemì´ ê³µí†µì ë„ ìˆëŠ”ë° ë°ì´í„° êµ¬ì¡°ë„ ê¸°ëŠ¥ë„ ë‹¬ë¼. ê³µí†µëœ ë¶€ë¶„ì„ ì¶”ìƒí™”í•˜ë©´ì„œë„ ë¶„ê¸°ë¥¼ í•  ìˆ˜ ìˆëŠ”ì§€ ë§Œë“¤ì–´ê°€ë©´ì„œ ì°¾ì•„ë‚´ì. ì´ˆê¸° ì„¤ê³„ëŠ” ì™„ë²½í•˜ì§€ ì•Šì•„ë„ ë˜ê³  í•„ìš”í•œ ê²ƒì„ ë°œê²¬í•œë‹¤ëŠ” ëŠë‚Œìœ¼ë¡œ.

> **í•œ ì¤„ ìš”ì•½**: ì™„ë²½í•œ ì„¤ê³„ë³´ë‹¤ ë‘ ì‹¤ì œ ì•±(Builder sidebar, Todo list)ì„ ë¦¬íŒ©í„°ë§í•˜ë©° ê³µí†µ íŒ¨í„´ì„ ë°œê²¬í•˜ëŠ” probe-first ì ‘ê·¼.

---

## Conclusion

### Why
ë§¤ ì•±ë§ˆë‹¤ onDelete, onCopy, onPaste, onMoveUp/Down, duplicate ë“±ì˜ ordered-collection ì»¤ë§¨ë“œë¥¼ ë°˜ë³µ ì‘ì„±í•˜ê³  ìˆë‹¤. êµ¬ì¡°ê°€ ë™í˜•ì¸ë° ì½”ë“œê°€ ì¤‘ë³µëœë‹¤.

### Intent
Zod schema + normalize/denormalize ì–´ëŒ‘í„°ë¥¼ ë°›ì•„ CRUD/clipboard/ordering ì»¤ë§¨ë“œì™€ Zone bind ì½œë°±ì„ ìë™ ìƒì„±í•˜ëŠ” **Collection Zone Facade** (`createCollectionZone`)ë¥¼ ë§Œë“ ë‹¤.

### Warrants (ëˆ„ì )

| # | Warrant |
|---|---------|
| W1 | Todo onDeleteì™€ Builder onDeleteì˜ êµ¬ì¡°ê°€ ë™í˜•ì´ë‹¤ (ids ì¶”ì¶œ â†’ ì œê±° â†’ í¬ì»¤ìŠ¤ ë³µêµ¬) |
| W2 | Move/Duplicate/Copy/Cut/Paste ëª¨ë‘ ë™ì¼í•œ ë°°ì—´ ì¡°ì‘ íŒ¨í„´ |
| W3 | Undo/Redo ì»¤ë§¨ë“œëŠ” ì™„ì „íˆ ë™ì¼í•œ ì½”ë“œì˜ ë³µë¶™ |
| W4 | JSONì€ Array ì•„ë‹ˆë©´ Object â†’ ì¡°ì‘ í•¨ìˆ˜ë„ ìœ í•œí•˜ë‹¤ |
| W5 | Redux Toolkitì˜ createEntityAdapterê°€ ë™ì¼ ë¬¸ì œë¥¼ ìŠ¤í‚¤ë§ˆ ê¸°ë°˜ìœ¼ë¡œ í•´ê²°í•œ ì„ ë¡€ |
| W6 | ì •ê·œí™”/ë¹„ì •ê·œí™” ë¶„ë¦¬ â€” ì—”ì§„ì€ `{ ids, entities }` í•˜ë‚˜ë§Œ ë‹¤ë£¨ë©´ ëª¨ë“  CRUDê°€ ë³´í¸ì  |
| W7 | Entity+Order êµ¬ì¡°(Todo)ëŠ” ì´ë¯¸ ì •ê·œí™”ëœ í˜•íƒœ â†’ normalize â‰ˆ identity |
| W8 | fromArray(), fromEntities() í”„ë¦¬ì…‹ìœ¼ë¡œ ëŒ€ë¶€ë¶„ í•œ ì¤„ í•´ê²° |
| W9 | History ë¯¸ë“¤ì›¨ì–´ê°€ "Zone ë¬´ìˆ˜ì • + ì»¤ë„ ìë™ ì²˜ë¦¬" ì„ ë¡€ â€” ì•„í‚¤í…ì²˜ ì¼ê´€ì„± |
| W10 | ë¯¸ë“¤ì›¨ì–´ íŒ¨í„´ì€ ì ì§„ì  ë§ˆì´ê·¸ë ˆì´ì…˜ í—ˆìš© |
| W11 | í¼ì‚¬ë“œëŠ” ê¸°ì¡´ ì½”ë“œ ìˆ˜ì • 0 + ë¯¸ë“¤ì›¨ì–´ ìŠ¹ê²© ê²½ë¡œ ë³´ì¡´ |
| W12 | í¼ì‚¬ë“œ bind() ê°ì‹¸ê¸°ì—ì„œ spread operatorë¡œ ì•± override ìì—°ìŠ¤ëŸ½ê²Œ ë°˜ì˜ |

### Architecture Stack (ìµœì¢…)

```
App State (ììœ ë¡œìš´ í˜•íƒœ)
  â†•  normalize() / denormalize()     â† ì•±ì´ ì œê³µ (ë˜ëŠ” fromArray/fromEntities í”„ë¦¬ì…‹)
Normalized: { ids: string[], entities: Record<string, T> }
  â†•  CRUD ì—”ì§„ (ìˆœìˆ˜, ë³´í¸, í•œ ë²ˆë§Œ ì‘ì„±)  â† ì‹œìŠ¤í…œ ì œê³µ
createCollectionZone facade
  â†•  zone.command() + zone.bind()   â† ê¸°ì¡´ ì¸í”„ë¼ ê·¸ëŒ€ë¡œ
Zone / Item / Trigger                â† ìˆ˜ì • ì—†ìŒ
```

### Open Design Decisions

1. **ID ë³€í™˜**: DOM focusId â‰  entity ID (Builderì˜ `sidebar-` prefix). Facadeì— `extractId` ì œê³µ vs convention ë³€ê²½.
2. **ID ìƒì„±**: paste/duplicate ì‹œ ìƒˆ ID ì „ëµ. ê¸°ë³¸ uid() ì œê³µ + `generateId?` ì˜µì…˜.
3. **ë¯¸ë“¤ì›¨ì–´ ìŠ¹ê²©**: í¼ì‚¬ë“œ ê²€ì¦ í›„ ì»¤ë„ ë¯¸ë“¤ì›¨ì–´ë¡œ ìŠ¹ê²© ê°€ëŠ¥. ì™¸ë¶€ API ë³€ê²½ ì—†ì´ ë‚´ë¶€ êµ¬í˜„ë§Œ êµì²´.

### Execution Strategy

**Probe-first (Complex ë„ë©”ì¸)**:
- Builder sidebar + Todo list ë‘ ì•±ì„ ì‹¤ì œë¡œ ë¦¬íŒ©í„°ë§í•˜ë©° ê³µí†µ íŒ¨í„´ ë°œê²¬
- ì´ˆê¸° ì„¤ê³„ëŠ” ì™„ë²½í•˜ì§€ ì•Šì•„ë„ ë¨
- ê³µí†µë¶€ëŠ” ì¶”ìƒí™”, ë¶„ê¸°(í¸ì§‘ ë“±)ëŠ” ì»¤ìŠ¤í…€ ì»¤ë§¨ë“œë¡œ ë³´ì¡´

> **í•œ ì¤„ ìš”ì•½**: Zod ìŠ¤í‚¤ë§ˆ + normalize/denormalize ì–´ëŒ‘í„° ê¸°ë°˜ì˜ Collection Zone Facadeë¥¼ probe-first ë°©ì‹ìœ¼ë¡œ, Builder sidebarì™€ Todo listë¥¼ ë¦¬íŒ©í„°ë§í•˜ë©° ë°œê²¬ì ìœ¼ë¡œ êµ¬ì¶•í•œë‹¤.
