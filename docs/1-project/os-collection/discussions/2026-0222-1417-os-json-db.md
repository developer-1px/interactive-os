# Discussion: OS Collection — OS는 프론트엔드의 JSON DB다

## Journey

**🧑 사용자**: Todo에서 bulk 삭제 후 undo시 문제가 있어. 테스트로 찾아봐.

**🤖 AI**: `confirmDeleteTodo`가 N개 sub-dispatch → N개 history entry. Undo가 1개만 복원. `produce()`로 inline 삭제하면 해결.

---

**🧑 사용자**: 이게 근본적인 수정이 맞아? CRUD + undo도 OS에서 하려는데?

**🤖 AI**: sub-dispatch batching을 커널에 구현 시도 → 복잡해짐.

**🧑 사용자**: /why — 오컴의 면도날. 복잡해지고 있는데?

**🤖 AI**: 멈춤. 근본 원인: 커널이 flat queue인데 hierarchy를 강제함. 
결론: sub-dispatch batching 불필요. data mutation은 1 command 안에서 atomic.
dispatch는 cross-scope side effect만.

---

**🧑 사용자**: 모든 CRUD를 OS에서 하고 싶어. 매번 다 동일하잖아.

**🤖 AI**: Focus처럼 축 기반 opt-in + lens(into/from) 제안.

**🧑 사용자**: 이런 기술 레퍼런스가 없을까? 10년 넘게 만든 건데?

**🤖 AI**: RFC 6902 (JSON Patch), Immer inverse patches, MST, RTK createEntityAdapter.

**🧑 사용자**: DOM이라는 대표 레퍼런스도 있지. DOM이랑 JSON이랑 다를게 없는데?

---

**🧑 사용자**: `collection: { entities, order, crud: true, ... }` — 이것도 표준이야?

**🤖 AI**: 아닙니다. 발명입니다.

**🧑 사용자**: 보일러플레이트를 없애는 게 목적이야. Goal 문서 읽어봤어?

**🤖 AI**: Goal #7: "앱은 의도를 선언하고, OS가 실행을 보장한다."

**🧑 사용자**: UI에 기능이 있으면 그냥 하면 되는거야. 이미 계약을 맞췄으니까.

---

**🧑 사용자**: 앱 데이터를 OS로 넘겨주는 과정을 함수로 만드는거야.

**🤖 AI**: read/write 함수(lens). OS가 데이터를 소유하고 커맨드를 생성.

**🧑 사용자**: 그러면 데이터를 OS에게 위임했다가 꺼내서 API 연동하든 뭐든 할 수 있잖아? JSON CRUD는 표준이고 정형화되었는데 매번 앱마다 그걸 개발하고 있잖아.

---

**한 줄 요약**: OS는 프론트엔드의 JSON DB다. 앱은 lens(read/write)로 데이터를 맡기고, OS가 RFC 6902 기반 CRUD + Immer inverse patches 기반 undo를 보장한다.

---

## Conclusion

### Why
매 앱마다 동일한 JSON CRUD (add/remove/replace/move/copy) + clipboard + undo/redo를 반복 구현하고 있다. 이것은 Backend에서 매 앱마다 DB를 직접 구현하는 것과 같다.

### Intent
OS가 프론트엔드의 JSON DB 역할을 수행한다. 앱은 read/write 함수 2개만 제공하고, 나머지 모든 CRUD 커맨드는 OS가 생성한다.

### Warrants
- W1. 표준이 있으면 발명하지 않는다 — RFC 6902 + Immer patches (rules.md #8)
- W2. 앱은 의도를 선언하고 OS가 실행을 보장한다 (Goal #7)
- W3. Lens(read/write)가 앱의 유일한 선언이다
- W4. OS가 커맨드를 생성한다 — `createCollectionZone`의 OS 승격
- W5. OS는 프론트엔드의 JSON DB다
- W6. UI 컴포넌트의 존재 = 기능의 존재. 설정이 아니라 계약이다.
- W7. DOM은 25년간 Tree CRUD를 제공해왔다. JSON = Tree. 표준이 이미 있다.

### 한 줄 요약
**앱은 read/write 함수로 데이터를 OS에 맡기고, OS는 RFC 6902 JSON Patch + Immer inverse patches로 모든 CRUD/clipboard/undo를 보장한다.**
