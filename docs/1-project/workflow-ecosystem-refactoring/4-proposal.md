# 제안서 — 워크플로 생태계 리팩토링

## 구현 방향

5개 액션을 순서대로 실행한다. 모두 `.agent/workflows/` 내 마크다운 파일 변경이며, 코드 변경은 없다.

---

## 액션 1: `/next` 폐기

- `next.md` 삭제

---

## 액션 2: `/go` 신규 생성

```markdown
---
description: 자율 실행 에이전트 루프. Known은 실행, Open은 보고하고 멈춘다.
---

## /go — 갈 수 있는 데까지 가라

### 원칙

> /divide의 자율 버전이다.
> 정답이 있으면 실행하고, 의사결정이 필요하면 보고서를 쓰고 멈춘다.
> 사용자가 "갈 수 있는 데까지 가" 라고 말할 때 쓴다.

### 절차

1. **컨텍스트 파악**
   - 최근 대화 히스토리, 열린 파일, task.md, `docs/1-project/` 진행 상태를 파악한다.
   - 지금 이어갈 작업이 무엇인지 판단한다.

2. **자율 실행 루프** (의사결정 필요 전까지 반복)
   - **Known** (정답이 있는 것) → 바로 실행. 멈추지 않는다.
   - **LLM이 잘 아는 것** → /resources 등으로 답을 찾아서 실행.
   - **Constrained** (선택지가 있는 것) → 최선의 선택지를 고르고 실행. 근거를 기록.
   - 실행 중 /fix (smoke/type/build)로 주기적 검증.

3. **멈춤 — 의사결정 필요**
   - **Open** (정답이 없는 것) → /inbox로 보고서 작성.
   - 보고서에 포함: 지금까지 한 것, 의사결정이 필요한 항목, 선택지와 트레이드오프.
   - 사용자를 호출하고 멈춘다.

4. **재개**
   - 사용자가 결정을 내리면, 2단계 루프로 돌아간다.
```

---

## 액션 3: `/refactor` 신규 생성

```markdown
---
description: 패턴 A를 패턴 B로 전환하는 리팩토링 파이프라인. 대상 식별부터 재발 방지까지.
---

## /refactor — 패턴 전환 파이프라인

### 원칙

> 리팩토링은 "패턴 A → 패턴 B" 전환이다.
> 대상을 전수 조사하고, 변환 규칙을 정의하고, 파일별로 적용하고, 구 패턴을 금지한다.

### 절차

1. **대상 식별**
   - grep/검색으로 패턴 A 사용처를 전수 조사한다.
   - 영향 범위(파일 수, 라인 수)를 집계한다.
   - 결과를 테이블로 정리: `| 파일 | 라인 | 현재 패턴 |`

2. **변환 규칙 정의**
   - 패턴 A → 패턴 B 매핑을 명확히 정의한다.
   - Before/After 코드 예시를 작성한다.
   - 엣지케이스를 식별한다.
   - 사용자에게 변환 규칙을 확인받는다.

3. **분해 & 적용 — `/divide`**
   - 파일별로 변환을 적용한다.
   - 각 파일 변환 후 단위 검증 (type check).

4. **코드 리뷰 — `/review`**
   - 변환된 코드가 프로젝트 철학을 준수하는지 확인한다.

5. **검증 — `/fix`**
   - smoke → type → build 순서로 시스템 안정성 확인.

6. **재발 방지 — `/rules`**
   - `.agent/rules.md`에 패턴 A 금지 규칙을 등록한다.
   - 예: "zustand useStore 대신 kernel.subscribe를 사용할 것"

7. **문서 퇴출 — `/archive`** (해당 시)
   - 패턴 A를 참조하는 문서를 `/archive`로 퇴출한다.

8. **결과 보고**
   - 변환 파일 수, 변경 라인 수, 검증 결과를 보고한다.
```

---

## 액션 4: `/make` → `/poc` 리네임 + 개선

```markdown
---
description: 아이디어를 빠르게 검증하는 PoC spike를 만든다. 별도 라우트 + GlobalNav 등록.
---

## /poc — Proof of Concept

### 원칙

> PoC는 "이거 되나?" 확인이다. 실패하면 버리면 된다.
> 별도 라우트에서 작업하고, GlobalNav에 등록하여 눈에 보이게 한다.

### Phase 1: Discovery (선택) — `/discussion`
1. 아이디어가 모호하면 `/discussion`으로 정리한다.
2. 이미 명확하면 스킵한다.

### Phase 2: PRD — `/inbox`
3. `/inbox`로 간략한 PRD를 작성한다.
   - 핵심 기능, 검증 목적, 스코프를 포함한다.

### Phase 3: 구현
4. **라우트 생성** — 별도 경로에 페이지를 생성한다.
5. **GlobalNav 등록** — `/routes`를 실행하여 아이콘+이름 매칭 → GlobalNav에 등록한다.
6. **spike 구현** — 최소한의 동작하는 코드를 작성한다.

### Phase 4: 검증 — `/fix`
7. smoke → type → build 검증.

### Phase 5: 판정
8. 사용자에게 질문: **"채택할까요, 폐기할까요?"**
   - ✅ **채택** → `/project`로 전환을 제안한다.
   - ❌ **폐기** → `/routes`를 실행하여 라우트 삭제 + GlobalNav 제거 + 관련 파일 정리.
```

---

## 액션 5: `/routes` 신규 생성

```markdown
---
description: 라우트 기반 앱 등록/제거. GlobalNav에 아이콘+이름을 매칭하고, 필요없으면 관련 코드와 함께 제거한다.
---

## /routes — 라우트 관리

### 등록 모드

1. **라우트 탐색** — 기존 라우트 파일을 스캔하여 등록되지 않은 라우트를 찾는다.
2. **아이콘+이름 매칭** — 각 라우트에 적절한 아이콘과 표시 이름을 부여한다.
3. **GlobalNav 등록** — 사이드바에 아이콘+이름으로 등록한다.
4. **확인** — 사용자에게 등록 결과를 보여준다.

### 제거 모드

1. **대상 선정** — 사용자가 제거할 라우트를 지정한다.
2. **영향 분석** — 해당 라우트와 관련된 파일 목록을 조사한다.
   - 페이지 컴포넌트, 라우트 설정, GlobalNav 항목, 관련 테스트
3. **제거 실행** — 관련 파일을 전부 삭제한다.
4. **GlobalNav 해제** — 사이드바에서 항목을 제거한다.
5. **검증 — `/fix`** — smoke → type → build로 사이드이펙트 확인.
6. **결과 보고** — 삭제된 파일 목록과 검증 결과를 보고한다.
```

---

## 리스크

| 리스크 | 대응 |
|--------|------|
| `/go`의 자율 실행이 예상치 못한 변경을 할 수 있음 | `/go` 내에서 `/fix` 주기적 검증 포함 |
| `/next` 폐기 후 기존 호출 습관 | `/next` 삭제 시 대체 안내 메시지 불필요 (사용자가 인지하고 있음) |

## 변경 범위

| 파일 | 변경 |
|------|------|
| `.agent/workflows/next.md` | 삭제 |
| `.agent/workflows/make.md` | 삭제 (poc.md로 교체) |
| `.agent/workflows/go.md` | 신규 |
| `.agent/workflows/refactor.md` | 신규 |
| `.agent/workflows/poc.md` | 신규 |
| `.agent/workflows/routes.md` | 신규 |
