# ğŸ”¥ í•´ê³  ë³´ê³ ì„œ

## ë‚ ì§œ
2026-02-24 01:37

## ì›ë˜ ëª©í‘œ
DocsSidebar íŠ¸ë¦¬ì—ì„œ í´ë”ë¥¼ í´ë¦­í•˜ë©´ expand í† ê¸€ì´ ë˜ì–´ì•¼ í•˜ëŠ”ë°, ì„ íƒë§Œ ë˜ê³  í† ê¸€ì´ ì•ˆ ë˜ëŠ” ë²„ê·¸ ìˆ˜ì •.

## ë‚´ê°€ ì‹œë„í•œ ê²ƒ

1. **T9: parseHashToPath ì´ˆê¸° ê²½ë¡œ ë²„ê·¸** â€” âœ… ì´ê±´ ì˜¬ë°”ë¥´ê²Œ ìˆ˜ì •ë¨ (ìœ ì§€ ê°€ëŠ¥)
2. **Tree click-expand ë²„ê·¸ ì§„ë‹¨** â€” `KEYBOARD_ONLY_EXPAND_ROLES`ì—ì„œ `treeitem` ì œê±°
3. ì œê±° í›„ double-toggle ë²„ê·¸ ë°œìƒ (mousedown + click ë‘˜ ë‹¤ OS_ACTIVATE)
4. ì´ë¥¼ ê¹¨ë‹¬ì€ í›„ ì›ë³µ
5. ê·¸ ì‚¬ì´ì— `isExpandTrigger`/`isCheckTrigger` dead code ì œê±°, `Item.ExpandTrigger` ì‚­ì œâ†’ë³µì›, í…ŒìŠ¤íŠ¸ ì¬ì‘ì„± ë“± ì™”ë‹¤ê°”ë‹¤

ì‹œê°„ìˆœ:
- `KEYBOARD_ONLY_EXPAND_ROLES`ì—ì„œ `treeitem` ì œê±° â†’ double-toggle ë²„ê·¸ ìƒì„±
- `isExpandTrigger`/`isCheckTrigger` ë¸Œëœì¹˜ ì œê±° (ì´ê±´ ì˜¬ë°”ë¦„ â€” dead codeì˜€ìŒ)
- `Item.ExpandTrigger` ì‚­ì œ â†’ ì‚¬ìš©ì ì§€ì ìœ¼ë¡œ ë³µì›
- `KEYBOARD_ONLY_EXPAND_ROLES` ì›ë³µ (treeitem ë‹¤ì‹œ ì¶”ê°€)
- ì‚¬ìš©ìê°€ "app ë²„ì „ì—ì„œ treeview í•´ë´" ì§€ì‹œ â†’ ë©”ì¸ app êµ¬ì¡° íŒŒì•… ì¤‘ í•´ê³ 

## ì™œ ì‹¤íŒ¨í–ˆëŠ”ê°€

### ê·¼ë³¸ ì›ì¸: Chesterton's Fence ìœ„ë°˜
- `KEYBOARD_ONLY_EXPAND_ROLES`ê°€ ì™œ ì¡´ì¬í•˜ëŠ”ì§€ ì´í•´í•˜ì§€ ì•Šê³  ì œê±°í–ˆë‹¤.
- **ì§„ì§œ ì´ìœ **: mousedownì—ì„œ expandí•˜ë©´ clickì—ì„œ ë˜ expand â†’ double toggle.
  - mousedown: focus + selectë§Œ (ì¦‰ì‹œ visual feedback)
  - click: OS_ACTIVATE â†’ OS_EXPAND (1íšŒë§Œ)
  - ì´ ë¶„ë¦¬ë¥¼ ë³´ì¥í•˜ëŠ” ê²Œ KEYBOARD_ONLY_EXPAND_ROLESì˜€ë‹¤.

### ì˜ëª»ëœ ê°€ì •
1. "`treeitem`ì´ ì´ Setì— ìˆëŠ” ê±´ ì‹¤ìˆ˜ë‹¤" â†’ ì˜ë„ì  ì„¤ê³„ì˜€ìŒ
2. "click(folder) = expandì´ë©´ ë˜ì§€" â†’ mousedownê³¼ clickì€ ë³„ê°œ ì´ë²¤íŠ¸
3. headless í…ŒìŠ¤íŠ¸ `createOsPage.click()`ì´ ì‹¤ì œ DOM clickì„ ì™„ì „ ì¬í˜„í•œë‹¤ê³  ê°€ì • â†’ ì‹¤ì œë¡œëŠ” mousedownë§Œ ì‹œë®¬ë ˆì´ì…˜, click ì´ë²¤íŠ¸(resolveClick)ëŠ” ì»¤ë²„ ì•ˆ ë¨

### í•´ê²° ëª» í•œ ì›ë˜ ë²„ê·¸
DocsSidebarì—ì„œ í´ë” í´ë¦­ì´ expand ì•ˆ ë˜ëŠ” ì§„ì§œ ì›ì¸ì„ ì•„ì§ íŒŒì•… ëª» í•¨.
ê°€ëŠ¥ì„±:
- docs-viewer(vite.docs.config.ts)ì— `<Root>`ê°€ ì—†ì–´ì„œ MouseListenerê°€ ì•ˆ ë¶™ì–´ìˆì„ ìˆ˜ ìˆìŒ
- ë˜ëŠ” DocsSidebarê°€ docs-viewer ëª¨ë“œì—ì„œ ë‹¤ë¥¸ ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ
- ë©”ì¸ app(`localhost:5173/docs`)ì—ì„œëŠ” `<Root>` ì•„ë˜ì´ë¯€ë¡œ ì •ìƒ ì‘ë™í•  ê°€ëŠ¥ì„± ë†’ìŒ

## í˜„ì¬ ìƒíƒœ

- ë§ˆì§€ë§‰ìœ¼ë¡œ ìˆ˜ì •í•œ íŒŒì¼ë“¤: 17ê°œ (git diff --stat ì°¸ì¡°)
- ë¹Œë“œ ìƒíƒœ: tsc pass
- í…ŒìŠ¤íŠ¸ ìƒíƒœ: 955/955 pass
- ë˜ëŒë ¤ì•¼ í•  ë³€ê²½:
  - `KEYBOARD_ONLY_EXPAND_ROLES` â€” ì´ë¯¸ ì›ë³µë¨ âœ…
  - `isExpandTrigger`/`isCheckTrigger` ì œê±° â€” dead codeì˜€ìœ¼ë¯€ë¡œ ìœ ì§€ ê°€ëŠ¥
  - `Item.ExpandTrigger` â€” ë³µì›ë¨ âœ…
  - T9 `parseHashToPath` â€” ì˜¬ë°”ë¥¸ ìˆ˜ì •, ìœ ì§€ âœ…
  - `rules.md` Item Compound ì›ì¹™ â€” outdated (isExpandTrigger ì°¸ì¡°), ì •ë¦¬ í•„ìš”
  - `SPEC.md` Â§9.3/9.4 â€” outdated, ì •ë¦¬ í•„ìš”

## ë‹¤ìŒ ì—ì´ì „íŠ¸ì—ê²Œ

### ì‹œë„í•˜ì§€ ë§ì•„ì•¼ í•  ì ‘ê·¼
1. **`KEYBOARD_ONLY_EXPAND_ROLES`ì—ì„œ `treeitem` ì œê±°í•˜ì§€ ë§ˆë¼** â€” double toggle ë²„ê·¸ ë°œìƒ
2. **headless `click()`ìœ¼ë¡œ tree expandë¥¼ í…ŒìŠ¤íŠ¸í•˜ì§€ ë§ˆë¼** â€” mousedownë§Œ ì‹œë®¬ë ˆì´ì…˜, click(resolveClick) ê²½ë¡œ ì»¤ë²„ ì•ˆ ë¨
3. **ìƒˆ ì»´í¬ë„ŒíŠ¸/í”Œë˜ê·¸ ë„ì… ì „ì— Occam Gate** â€” ê¸°ì¡´ ë©”ì»¤ë‹ˆì¦˜ìœ¼ë¡œ í•´ê²° ê°€ëŠ¥í•œì§€ ë¨¼ì € í™•ì¸

### ìœ ë§í•´ ë³´ì´ëŠ” ë°©í–¥
1. **ë©”ì¸ app(`localhost:5173/docs`)ì—ì„œ treeê°€ ì •ìƒ ì‘ë™í•˜ëŠ”ì§€ ë¨¼ì € í™•ì¸** â€” `<Root>` ì•„ë˜ì´ë¯€ë¡œ MouseListener + click í•¸ë“¤ëŸ¬ ëª¨ë‘ í™œì„±
2. **docs-viewer(`localhost:4444`)ì—ì„œ `<Root>`ê°€ ë Œë”ë˜ëŠ”ì§€ í™•ì¸** â€” DocsViewer.tsxì˜ ìµœìƒìœ„ ì»´í¬ë„ŒíŠ¸ êµ¬ì¡° í™•ì¸
3. **resolveClick ê²½ë¡œ í…ŒìŠ¤íŠ¸ ì¶”ê°€** â€” `resolveClick({ activateOnClick: true, focusedItemId })` ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ëŠ” ì´ë¯¸ item-expand.test.tsì— ìˆìŒ
4. í•µì‹¬ ì•„í‚¤í…ì²˜: `mousedown = focus+select` / `click = activate(expand/action)` ì´ ë¶„ë¦¬ë¥¼ ì´í•´í•˜ê³  ìœ ì§€

### ì°¸ê³ í•  íŒŒì¼/ë¬¸ì„œ
- `src/os/1-listeners/mouse/MouseListener.tsx` â€” mousedown + click ì´ì¤‘ ë¦¬ìŠ¤ë„ˆ êµ¬ì¡°
- `src/os/1-listeners/mouse/resolveClick.ts` â€” click ì´ë²¤íŠ¸ â†’ OS_ACTIVATE
- `src/os/1-listeners/mouse/resolveMouse.ts` â€” mousedown â†’ OS_FOCUS + OS_SELECT (treeitem expand ì œì™¸)
- `src/os/3-commands/interaction/activate.ts` â€” OS_ACTIVATE â†’ expandable â†’ OS_EXPAND
- `src/docs-viewer/app.ts` L122-130 â€” DocsSidebarUI bind config (activate: { onClick: true })
- `src/routes/__root.tsx` L63 â€” `<Root>` ë˜í¼ (MouseListener í¬í•¨)
- `docs/0-inbox/fired-2026-02-24-0137.patch` â€” ì „ì²´ ë³€ê²½ diff
