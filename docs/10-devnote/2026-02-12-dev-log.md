# 📓 DevLog: 2026-02-12

## 🌡️ Today's Vibe
🔥🏗️💀 절거, 정리, 토론, 수술 — 레거시 대청소 + 아키텍처 확정의 날

## 💬 3-Line Summary
- 레거시 OS 코드 완전 제거: `src/os/` 삭제, `core/`, `store/`, `lib/`, `shared/` 해체 (210+ 파일, ~5900줄 삭제)
- 소크라테스식 논증으로 OS 이상적 구조 확정: 파이프라인 6개 + 비파이프라인 3개 + 컴포넌트 3층
- `1-listeners` 리팩토링 실전 적용: `*Listener` 통일, `keymaps/` 분리, STUB 삭제

## 🎞️ Highlights

오늘은 진짜 **대수술**이었다. 아침부터 `Phase 0 → Phase 3`까지 밀어붙였다.

**Phase 0**: 죽은 코드 제거. Kanban 페이지, 스파이크 데모 삭제로 ~750줄 날림. 가벼운 워밍업.

**Phase 1~2**: 커널 앱 상태 인프라 구축. `kernel.lens()` 도입으로 앱별 상태 격리 패턴을 만들었다. 근데 여기서 Gap이 발견됨. Resolution(누가 resolve하느냐)과 Ownership(누가 소유하느냐) 경계가 명확하지 않아서 소크라테스 토론까지 갔다.

**Phase 3**: 레거시 `CommandEngineStore` 파이프라인 완전 제거. 210파일을 건드리는 거대 리팩토링. Zustand 의존성도 같이 날렸다. 그 후 `core/`, `store/`, `lib/`, `shared/` 까지 전부 해체해서 소비자 근처로 재배치.

그리고 밤에 **소크라테스 논증 세션**이 하이라이트. "현재 OS 구조" 전체를 점검했는데:
- `2-contexts`가 React Context 아니라 `ctx.inject()` 대응이라는 걸 코드로 증명
- 넘버링(1~6)이 re-frame 6 도미노와 정확히 일치한다는 것 확인
- `6-components` 3층 구조(`base/primitives/radix`) 합의
- `1-listeners` 네이밍 불일치 발견 → `*Listener` 통일 + `keymaps/` 분리 실행

마무리는 50+ 타입 에러 수정. 커널 `createKernel` 제네릭 시그니처 정리.

## 💎 Discoveries & Insights

- **"번호 있음 = 파이프라인, 번호 없음 = 횡단 인프라"** — 이 원칙이 폴더 구조 결정의 만능키
- **`keybindings`는 파이프라인이 아니라 설정 데이터** — listener가 흐르는 곳에 설정이 섞여있으면 안 됨
- **"모든 것은 Zone이다"** — App도 Kernel도 Zone. keybinding은 Zone 스코프 + 버블링. 이건 별도 논의가 필요할 정도로 큰 건
- **FocusSensor가 mouse+focus+recovery를 동시 처리** — 분리하고 싶었지만 `isDispatching` 공유 상태 때문에 실익이 없다고 판단
- **코드가 근거다** — `2-contexts` 이름 논쟁에서 "사용자가 맞다고 해서"가 아니라 `kernel.defineContext` 코드가 근거였음

## 🚀 Next Steps

- [ ] 키바인딩 시스템 설계 논의 (Zone 스코프 + 버블링, `onAction` 등의 범용화)
- [ ] `6-components/` 내부 3층 서브폴더 실제 적용 (`base/`, `primitives/`, `radix/`)
- [ ] `registry/roleRegistry.ts` → `schema/focus/`로 이동 검토
- [ ] `apps/todo` 타입 에러 해결 (`AppState` 타입 충돌)
