# 📓 DevLog: 2026-02-10 (월)

## 🌡️ Today's Vibe
🤯🔥🏗️ — 뇌 과부하 + 텐션 최고 + 대공사. 오늘은 진짜 "집 리모델링하면서 살기" 같은 하루였다.

## 💬 3줄 요약
- 커널 아키텍처를 거의 처음부터 다시 잡았다. HMR, 스코프 트리, 포커스 파이프라인까지.
- TanStack Router 마이그레이션 완료하고, 레거시 코드 60개 파일을 한 방에 정리했다.
- TestBot 커서를 React 컴포넌트로 분리하고, Playwright E2E 74개 스펙을 셋업했다.

## 🎞️ Highlights

### 🏗️ 커널 대공사 — "기초부터 다시"
오늘의 메인 이벤트. 커널을 HMR-safe하게 만들고, Inspector에 KERNEL 탭을 연결하는 것부터 시작했다. 처음엔 "dispatch에 meta만 끼우면 되겠지"라고 가볍게 생각했는데, 열어보니 `Transaction` 타입이 여기저기 얽혀 있어서 타입 정리부터 한참 걸렸다.

스코프 트리 자동 버블링(`ctx.inject`)이랑 3-arg `defineCommand`를 넣었을 때는 꽤 뿌듯했다. 13개 테스트 중 11개가 바로 통과했고, 나머지 2개는 포커스 파이프라인 쪽이라 "이건 내일 잡자"로 넘겼다.

포커스 파이프라인 인프라를 굳히는 작업도 했는데, `dispatchToZone`, Rule 시스템, command 시리즈(`activate`, `escape`, `expand`, `focus`, `navigate`, `select`, `tab`...)를 죄다 새로 짰다. 107개 파일이 변경되었고, +5,175 / -1,626 라인. 솔직히 좀 무서웠다.

### 🧹 레거시 청소 — "60개 파일 삭제의 쾌감"
`ts-morph`로 dead code를 분석하고, proxy re-export 파일 24개를 포함해서 총 60개 파일을 날렸다. 빌드 터질까 봐 조마조마했는데, `component-inspector`만 false positive으로 잠깐 놀라고 나머지는 깔끔하게 정리됐다.

### 🔀 TanStack Router 마이그레이션
기존 라우팅을 TanStack Router 파일 기반 라우팅으로 전환했다. `_minimal` 레이아웃 라우트 처리하면서 잠깐 멘붕이 왔는데, splat(`$`) 캐치올 패턴으로 해결. 근데 `_minimal`이라는 이름은... 아직도 마음에 안 든다.

### 🤖 TestBot 커서 → React 컴포넌트
기존에 DOM 직접 조작하던 `BotCursor`를 Zustand 스토어 + React Portal(`CursorOverlay`)로 분리했다. 이게 진짜 신의 한 수였다. 상태 추적이 세상 편해짐. 기존 imperative API도 그대로 유지해서 호환성 걱정 없음.

### 🎭 Unified Inspector + Playwright
Inspector를 통합하고, Playwright E2E 테스트 74개 스펙을 셋업했다. `babel-plugin`에서 `data-inspector` 속성이 중복으로 들어가는 버그도 잡았다. 이건 진짜 찾기 힘들었을 텐데 다행히 빨리 발견.

## 💎 Discoveries & Insights

- **커널 코드가 빠르게 두꺼워지고 있다.** `createKernel.ts` 하나에 535줄 이상 들어가고 있는데, 조만간 모듈 분리를 진지하게 고민해야 한다. `core/` 폴더의 파일들(`context.ts`, `createStore.ts`, `group.ts`, `pipeline.ts`)을 삭제하고 `createKernel.ts`로 합친 건 단기적으론 맞는 선택이었지만, 장기적으로는 다시 분리가 필요할 듯.
- **Registry 패턴이 꽤 잘 먹힌다.** `InspectorRegistry`를 도입해서 커널 Inspector를 동적으로 등록/해제하는 구조를 만들었는데, 이 패턴을 다른 곳(플러그인 시스템?)에도 써먹을 수 있을 것 같다.
- **Zustand + TanStack Router 조합이 생각보다 궁합이 좋다.** 라우팅 상태와 앱 상태가 깔끔하게 분리되면서도, 필요할 때 서로 참조하기가 편하다.
- **ADR 문서가 벌써 24개.** 이건 좋은 신호다. 의사결정 기록이 쌓이면서and "왜 이렇게 했더라?" 순간에 정말 도움이 된다.

## 🚀 Next Steps

- [ ] 포커스 파이프라인 나머지 2개 테스트 통과시키기
- [ ] `createKernel.ts` 모듈 분리 설계 초안
- [ ] Playwright smoke test 타임아웃 이슈 안정화
- [ ] `_minimal` 레이아웃 라우트 이름 변경 검토
- [ ] `docs/0-inbox`에 쌓인 분석 리포트들 PARA 정리

## 📊 Today's Numbers
| 항목 | 수치 |
|------|------|
| 커밋 | 13건 |
| 변경 파일 | 234개 |
| 추가 라인 | +14,927 |
| 삭제 라인 | -5,459 |
| 삭제한 레거시 파일 | 60개 |
| ADR 문서 | 24개 (누적) |
| Playwright 스펙 | 74개 (신규) |

---
*"오늘은 집을 부수면서 동시에 새 집을 짓는 기분이었다. 근데 솔직히? 꽤 재밌었다."* 🏗️✨
