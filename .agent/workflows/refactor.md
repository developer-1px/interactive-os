---
description: 패턴 A를 패턴 B로 전환하는 리팩토링 파이프라인. 대상 식별부터 재발 방지까지.
---

## /refactor — 패턴 전환 파이프라인

> **이론적 기반**:
> - Martin Fowler *Refactoring* — 행동 보존 코드 변환
> - **Mikado Method** (Ola Ellnestam & Daniel Brolund) — 리팩토링 의존 그래프를 추적하여 말단부터 순서대로 변환
> - **Strangler Fig Pattern** (Martin Fowler) — 구 패턴을 신 패턴으로 점진 교체 후 제거

### 원칙

> 리팩토링은 "패턴 A → 패턴 B" 전환이다.
> 대상을 전수 조사하고, 변환 규칙을 정의하고, 의존 그래프 순서대로 적용하고, 구 패턴을 금지한다.

### 절차

0. **의심 — `/doubt`** (선택)
   - 리팩토링 대상에 `/doubt`를 먼저 적용한다.
   - "패턴 A를 B로 바꾸는 게 아니라, 애초에 없앨 수 있는 건 아닌가?"
   - 제거 가능한 코드를 먼저 제거하면 변환 대상이 줄어든다.

1. **대상 식별**
   - grep/검색으로 패턴 A 사용처를 전수 조사한다.
   - 영향 범위(파일 수, 라인 수)를 집계한다.
   - 결과를 테이블로 정리: `| 파일 | 라인 | 현재 패턴 |`

2. **변환 규칙 정의**
   - 패턴 A → 패턴 B 매핑을 명확히 정의한다.
   - Before/After 코드 예시를 작성한다.
   - 엣지케이스를 식별한다.
   - 사용자에게 변환 규칙을 확인받는다.

3. **분해 & 적용 — `/divide`**
   - 파일별로 변환을 적용한다.
   - 각 파일 변환 후 단위 검증 (type check).

5. **코드 리뷰 — `/review`**
   - 변환된 코드가 프로젝트 철학을 준수하는지 확인한다.

6. **검증 — `/fix`**
   - smoke → type → build 순서로 시스템 안정성 확인.

7. **재발 방지 — `/rules`**
   - `.agent/rules.md`에 패턴 A 금지 규칙을 등록한다.
   - 예: "zustand useStore 대신 kernel.subscribe를 사용할 것"

8. **문서 퇴출 — `/archive`** (해당 시)
   - 패턴 A를 참조하는 문서를 `/archive`로 퇴출한다.

9. **회고 — `/retrospect`**
   - 리팩토링 과정의 개발·협업·워크플로우를 KPT로 회고한다.

10. **결과 보고**
   - 변환 파일 수, 변경 라인 수, 검증 결과를 보고한다.
