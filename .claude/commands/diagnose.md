---
description: 테스트 실패 시 코드를 수정하지 않고 원인을 분석하여 삽질 일지를 작성한다.
---

1. **테스트 실행**: 사용자가 지정한 테스트 명령(또는 프로젝트 기본 테스트 명령)을 실행한다.

2. **통과 시 종료**: 모든 테스트가 통과하면 "✅ 모든 테스트 통과, 진단할 거리가 없습니다." 메시지와 함께 종료한다.

3. **실패 시 삽질 시작**: 테스트가 실패하면 다음 과정을 수행한다.

   ### 수정 정책
   - **명백한 실수는 즉시 수정한다**: import 누락, 오타, 잘못된 API 이름 등
     줄 수 변화 없이 글자만 바꾸면 되는 수준의 수정은 바로 고친다.
   - **그 외에는 코드를 수정하지 않는다.** 읽기 전용 분석만 한다.

   ### 분석 과정
   - 실패한 테스트 목록을 정리한다.
   - 각 실패에 대해:
     a. 에러 메시지와 스택 트레이스를 읽는다.
     b. 관련 소스 코드와 테스트 코드를 탐색한다.
     c. "왜 실패했을까?" 가설을 세우고, 코드를 따라가며 검증한다.
     d. 근본 원인(root cause)을 추정한다.
   - 명백한 실수를 수정한 경우 테스트를 재실행하여 결과를 확인한다.

4. **삽질 일지 작성**: `docs/0-inbox/YYYY-MMDD-HHmm-[analysis]-diagnose-{slug}.md` 에 다음 형식으로 저장한다.

   ```markdown
   # 🔍 삽질 일지: [한줄 제목]

   > 날짜: YYYY-MM-DD
   > 실행 명령: `[실행한 테스트 명령]`
   > 결과: X개 실패 / Y개 통과

   ## 증상
   어떤 테스트가, 어떻게 실패했는지 날것 그대로 기록.

   ## 즉시 수정한 것들
   명백한 오타/import 누락 등 글자 수준 수정 내역. 없으면 생략.
   - `파일명`: 변경 전 → 변경 후 (사유)

   ## 삽질 과정
   개발자가 디버깅하듯 서술형으로 작성한다.
   - "처음엔 ~일 거라 생각했는데..."
   - "코드를 따라가보니 ~에서 ~가 일어나고 있었다"
   - "그래서 혹시 ~인가 싶어서 ~를 확인해봤더니..."
   - 막다른 골목도 솔직하게 기록한다.

   ## 원인 추정 — 5 Whys

   표면적 원인에서 멈추지 않고, **5단계까지 파고든다**:

   1. 왜 [증상]이 발생했나? → [직접 원인]
   2. 왜 [직접 원인]이 생겼나? → [중간 원인]
   3. 왜 [중간 원인]이 생겼나? → [더 깊은 원인]
   4. 왜 [더 깊은 원인]이 생겼나? → [구조적 원인]
   5. 왜 [구조적 원인]이 존재했나? → [근본 원인]

   → **근본 원인**: [1문장 요약]
   → **확신도**: 높음 / 중간 / 낮음

   5단계 전에 근본 원인에 도달하면 거기서 멈춘다.
   3단계에서 막히면 "여기까지만 추적 가능, 추가 정보 필요"라고 명시한다.

   ## 다음 액션 제안
   코드를 고친다면 어디를 어떻게 고쳐야 할지 방향만 제시.
   (직접 수정하지 않는다)
   ```

5. **사용자에게 보고**: 작성된 삽질 일지 경로를 사용자에게 알린다.
